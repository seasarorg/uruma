<?xml version="1.0" encoding="UTF-8"?>
<project default="execute_rcp" name="org.seasar.uruma.example.filemanager">
	<!-- プラグイン名 -->
	<property name="PLUGIN_NAME" value="org.seasar.uruma.example.filemanager" />

	<!-- プラグイン jar ファイル名 -->
	<property name="PLUGIN_JAR" value="${RCP_DEPLOY_DIR}/plugins/${PLUGIN_NAME}_0.3.0.jar" />

	<!-- RCP デプロイ先ディレクトリ -->
	<property name="RCP_DEPLOY_DIR" value="D:/Develop/RCP-3.3.1.1/eclipse" />

	<!-- エクスポートログファイル -->
	<property name="LOGS_ZIP" value="${RCP_DEPLOY_DIR}/logs.zip" />

	<!-- RCP コンフィグレーションディレクトリ -->
	<property name="CONFIG_DIR" value="${RCP_DEPLOY_DIR}/configuration" />

	<!-- RCP ログディレクトリ -->
	<property name="LOG_DIR" value="${RCP_DEPLOY_DIR}/log" />

	<!-- Uruma プロジェクトディレクトリ -->
	<property name="URUMA_DIR" value="../uruma" />

	<!-- このプロジェクトの lib ディレクトリ -->
	<property name="LIB_DIR" value="lib" />

	<!-- Maven ホームディレクトリ -->
	<property name="MAVEN_HOME" value="c:/maven" />

	<!-- Maven リポジトリディレクトリ -->
	<property name="MAVEN_REPO" value="c:/.m2" />

	<!-- Uruma リポジトリディレクトリ -->
	<property name="URUMA_REPO" value="${MAVEN_REPO}/repository/org/seasar/uruma/uruma" />

	<!-- Uruma バージョン -->
	<property name="URUMA_VER" value="0.3.0-SNAPSHOT" />

	<!-- Uruma Jar ファイル -->
	<property name="URUMA_JAR" value="${URUMA_REPO}/${URUMA_VER}/uruma-${URUMA_VER}.jar" />

	<!-- Uruma SourceJar ファイル -->
	<property name="URUMA_SRC_JAR" value="${URUMA_REPO}/${URUMA_VER}/uruma-${URUMA_VER}-sources.jar" />

	<target name="compile">
		<exec dir="${URUMA_DIR}" executable="cmd">
			<arg line="/c ${MAVEN_HOME}/bin/mvn install" />
		</exec>
	</target>

	<target name="copy_jar" depends="compile">
		<copy file="${URUMA_JAR}" todir="${LIB_DIR}" />
		<copy file="${URUMA_SRC_JAR}" todir="${LIB_DIR}" />
	</target>

	<target name="plugin_export" depends="copy_jar">
		<delete file="${RCP_DEPLOY_DIR}/plugins/${PLUGIN_JAR}" />
		<delete file="${LOGS_ZIP}" />

		<pde.exportPlugins destination="${RCP_DEPLOY_DIR}" exportSource="true" exportType="directory" plugins="${PLUGIN_NAME}" useJARFormat="true" />

		<fail message="プラグインのエクスポートに失敗しました.">
			<condition>
				<available file="${LOGS_ZIP}" />
			</condition>
		</fail>
	</target>

	<target name="clean_rcp" depends="plugin_export">
		<delete dir="${CONFIG_DIR}" />
		<delete dir="${LOG_DIR}" />
		<mkdir dir="${CONFIG_DIR}" />
		<mkdir dir="${LOG_DIR}" />
		<copy file="config.ini" todir="${CONFIG_DIR}" />
	</target>

	<target name="execute_rcp" depends="clean_rcp">
		<exec dir="${RCP_DEPLOY_DIR}" executable="eclipse.exe" vmlauncher="false" spawn="true" />
	</target>
</project>
